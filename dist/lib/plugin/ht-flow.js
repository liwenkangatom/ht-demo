!function(i){"use strict";var N=i.ht,J=N.Default,U=J.getInternal(),r=U.ui(),Z=null,E="__segmentLengths",S="__lineTotalLength",t="__linePoints",F="__distance0",f="flow.count",O="flow.step",p="flow.element.max",R="flow.element.count",s="flow.element.min",D="flow.element.space",A="flow.element.autorotate",K="flow.element.background",a="flow.element.shadow.max",_="flow.element.shadow.min",M="flow.element.shadow.begincolor",X="flow.element.shadow.endcolor",o="flow.element.shadow.visible",y="flow.element.image",v="flow",T=N.Math.Vector2,x=new T;new T,new T,N.List;var d=N.Default._edgeProtectMethod,e=d.getStraightLinePoints,P=function(L,h){for(var s=[],D=L.length,T=0;D>T;T++){var j=L[T];j._as&&(j=j._as);for(var f=j[0],v=1;v<j.length;v++)s.push([f,j[v]]),f=j[v]}for(var A=[],T=0;T<s.length;T++){var e=Q(s[T][0],s[T][1],h);A.push(e)}return{distance:A,segments:s}},B=function(d,T,x){if(d){for(var l,b=P(d,T),$=b.distance,r=b.segments,g=1/0,L=null,A=0,q=$.length;q>A;A++){var F=$[A];F.z<g&&(l=A,g=F.z,L=F)}if(null==x&&(x=.1),L.z<x){for(var y=0,a=0;l>=a;a++)y+=J.getDistance(r[a][0],l>a?r[a][1]:L);return y}}},Q=function(I,E,F){var V=I.x,R=I.y,M=E.x,r=E.y,Y=F.x,h=F.y,m=M-V,U=r-R,Z=Math.sqrt(m*m+U*U),G=m/Z,X=U/Z,S=(-V+Y)*G+(-R+h)*X,w={x:V+S*G,y:R+S*X};return w.x>=Math.min(I.x,E.x)&&w.x<=Math.max(I.x,E.x)&&w.y>=Math.min(I.y,E.y)&&w.y<=Math.max(I.y,E.y)||(w.x=Math.abs(w.x-I.x)<Math.abs(w.x-E.x)?I.x:E.x,w.y=Math.abs(w.y-I.y)<Math.abs(w.y-E.y)?I.y:E.y),m=Y-w.x,U=h-w.y,w.z=Math.sqrt(m*m+U*U),w},q=function(c,o){if(c){var w=P(c,o).distance,X=1/0,B=null;return w.forEach(function(H){H.z<X&&(X=H.z,B=H)}),B}},H=d.calculateLineLength,L=d.calcSegmentIndexByDistance,W=d.calculatePointAlongLine,c=function(M,E,J){if(!M)return J;if(0===E){var z=M[0][0],f=M[0][1];return J+Math.atan2(f.y-z.y,f.x-z.x)}if(100===E){M=M[M.length-1];var z=M[M.length-2],f=M[M.length-1];return J+Math.atan2(f.y-z.y,f.x-z.x)}for(var D=0,r=[],K=M.length,N=0;K>N;N++){var $=M[N],A=H($);D+=A,r.push(A)}for(var I=D*E/100,o=L(I,r),b=0,n=0;o>n;n++)b+=r[n];I-=b;for(var g=W(M[o],I),P=M[o],S=0,T=0,x=0;x<P.length-1;x++){var k=P[x],Z=P[x+1],w=Z.x-k.x,m=Z.y-k.y,i=Math.sqrt(w*w+m*m);if(S+=i,S>I){T=x;break}}var F=P[T];return J+Math.atan2(g.y-F.y,g.x-F.x)},u=function(y){var e=0;if(y)if(Array.isArray(y[0]))for(var s=y.length,k=0;s>k;k++){var m=y[k],$=H(m);e+=$}else e=H(y);return e},I=function(C,E,G,e){return x.set(E,G).rotateAround(null,e),C?{x:C.x+x.x,y:C.y+x.y}:{x:x.x,y:x.y}},j=function(q){var k=q._data,z=e(q);if(z){k.s("flow.reverse")&&(z.reverse(),z.forEach(function(_){_.reverse()}));for(var c=0,L=[],b=z.length,d=0;b>d;d++){var j=z[d],B=H(j);c+=B,L.push(B)}if(k[E]=L,k[S]=c,k[t]=z,k instanceof N.Edge){var Z=J.unionPoint(z),_=Z.x+Z.width/2,h=Z.y+Z.height/2;k.$10e={x:_,y:h}}l(q,!0)}},z=d.getPercentPosition,l=function(D,b){var U=D._data,W=U[S],o=U.s(f),P=U.s(O),r=0,q=U[E],z=U.s(p),_=U.s(s),J=U.s(R),h=(z-_)/(J-1),N=[];if(q){if(1===J)N.push(z);else if(2===J)N.push(z),N.push(_);else{if(!(J>2))return;N.push(z);for(var k=J-2;k>0;k--)N.push(_+h*k);N.push(_)}var Z=0,v=0;N.forEach(function(b){J-1>Z&&(v+=U.getFlowElementSpace(b)),Z++}),v+=(z+_)/2,r=(W-o*v+v)/o;var x=D[F];for(null==x&&(x=0),b||(x+=P);x>W+v;){var X=D._overCount;X?X++:X=1,X>=o&&(X=null),D._overCount=X,U.s("flow.autoreverse")?X?x-=r+v:(x=0,U.s("flow.reverse",!U.s("flow.reverse"))):x-=r+v}D[F]=x}},b="prototype",G=N.graph.GraphView[b],Y=N.Data[b],n=r.DataUI[b],h=r.ShapeUI[b],C=r.EdgeUI[b],w=N.DataModel[b],k=N.Style;k[p]==Z&&(k[p]=7),k[s]==Z&&(k[s]=0),k[f]==Z&&(k[f]=1),k[O]==Z&&(k[O]=3),k[R]==Z&&(k[R]=10),k[D]==Z&&(k[D]=3.5),k[A]==Z&&(k[A]=!1),k[K]==Z&&(k[K]="rgba(255, 255, 114, 0.4)"),k[M]==Z&&(k[M]="rgba(255, 255, 0, 0.3)"),k[X]==Z&&(k[X]="rgba(255, 255, 0, 0)"),k[o]==Z&&(k[o]=1),k[a]==Z&&(k[a]=22),k[_]==Z&&(k[_]=4),G.calculatePointLength=function(k,c,R){var Z=this.getDataUI(k),z=e(Z);return B(z,c,R)},J.calculatePointLength=function(H,p,b,h){var n=e(Z,H,p);return B(n,b,h)},J.calculateClosestPointOnLine=Q,G.calculateClosestPoint=function(v,R){var P=this.getDataUI(v),c=e(P);return q(c,R)},J.calculateClosestPoint=function(E,w,k){var g=e(Z,E,w);return q(g,k)},G.getPercentAngle=function(s,U){var K=this.getDataUI(s),$=e(K);return s.getRotation?s.getRotation():0,c($,U,s.getRotation?s.getRotation():0)},J.getPercentAngle=function(J,X,N){var E=e(Z,J,X);return c(E,N,0)},G.calculateLength=function(b){var Z=this.getDataUI(b),M=e(Z);return u(M)},J.calculateLength=function(l,W){var m=e(Z,l,W);return u(m)},G.getPercentPosition=function(M,G){var O=this.getDataUI(M),u=e(O);return z(u,G)},J.getPercentPositionOnPoints=function(g,k,U){var v=e(Z,g,k);return z(v,U)};var g=function(F){var i=F.data,b=this.dm();if(i&&"add"===F.kind){var y=b.$3e;y&&i.s(v)&&y.indexOf(i)<0&&y.push(i)}"clear"===F.kind&&(b.$3e=[])},$=function(C){var r=C.property,k=C.data,O=C.newValue,g=this.dm().$3e;if(g&&"s:flow"===r)if(O)g.indexOf(k)<0&&g.push(k);else for(var b=g.length,G=0;b>G;G++)if(g[G]===k){g.splice(G,1);break}},V=G.setDataModel;G.setDataModel=function(r){var X=this,k=X._dataModel;if(k!==r){k&&(k.umm(g,X),k.umd($,X),k.$3e=[]),r.mm(g,X),r.md($,X);var Z=r.$3e=[];r.each(function(d){d.s(v)&&Z.indexOf(d)<0&&Z.push(d)}),V.call(X,r)}},Y.getFlowElementSpace=function(){return this.s(D)};var m=function(n){var m=this,u=m._data,P=u[S],z=u[E],v=u[t],X=u.s(f),q=0,g=m[F],T=u.s(p),c=u.s(s),d=u.s(R),r=u.s(_),w=u.s(a),$=u.s(A),Q=(w-r)/(d-1),N=(T-c)/(d-1),j=u.getRotation?u.getRotation():0,C=u.getPosition?u.p():u.$10e,x=[],O=[];if(g!=Z){if(1===d)x.push(T);else if(2===d)x.push(T),x.push(c);else{if(!(d>2))return;x.push(T);for(var H=d-2;H>0;H--)x.push(c+N*H);x.push(c)}if(1===d)O.push(w);else if(2===d)O.push(w),O.push(r);else{if(!(d>2))return;O.push(w);for(var H=d-2;H>0;H--)O.push(r+Q*H);O.push(r)}var U=0,Y=0;x.forEach(function(q){d-1>U&&(Y+=u.getFlowElementSpace(q)),U++}),Y+=(T+c)/2,q=(P-X*Y+Y)/X,n.save();for(var H=0;X>H;H++){var D=g,J=0,V=m._overCount,G=0;u.s("flow.autoreverse")&&V&&V>X-(H+1)||(D-=H*(q+Y),U=0,x.forEach(function(a){var F=D-J;if(F>=0&&P>F){var Y=!0,f=L(F,z);G=0;for(var i=0;f>i;i++)G+=z[i];if(F-=G,Y){var M=W(v[f],F),S=j;if($){for(var s=v[f],e=0,X=0,h=0;h<s.length-1;h++){var p=s[h],T=s[h+1],R=T.x-p.x,Z=T.y-p.y,_=Math.sqrt(R*R+Z*Z);if(e+=_,e>F){X=h;break}}var k=s[X];S+=Math.atan2(M.y-k.y,M.x-k.x)}j&&(M=I(C,M.x-C.x,M.y-C.y,j)),m.$5e(n,M,a,O[U],S)}}J+=u.getFlowElementSpace(x[U]),U++}))}n.restore()}},nr=C._80o;C._80o=function(X){nr.call(this,X);var U=this,Q=U._data,S=U.gv;Q.s(v)&&S.$7e!=Z&&m.call(U,X)};var kn=h._80o;h._80o=function(x){kn.call(this,x);var F=this,f=F._data,p=F.gv;f.s(v)&&p.$7e!=Z&&m.call(F,x)};var hf=C._79o,sm=h._79o,No=function(){var G=this,P=G._data,M=P.s(p),A=!1,w=Z;if(G._6I||(A=!0),w=P instanceof N.Edge?hf.call(G):sm.call(G),P.s(v)&&A){var B=P.s(a),y=P.s(o);y&&B>M&&(M=B),M>0&&J.grow(w,Math.ceil(M/2)),j(G)}return!P.s(v)&&A&&(P[E]=P[S]=P[t]=G[F]=Z),w};h._79o=No,C._79o=No,n.$5e=function(f,p,d,L,O){var s=this,D=s._data,A=s.gv,Y=D.s(K),B=D.s(M),i=D.s(X),x=D.s(o),l=A.$8e,G=D.s(y);if(l==Z&&(l=A.$8e={}),f.beginPath(),G!=Z){var S=J.getImage(G),h=d/2;f.translate(p.x,p.y),f.rotate(O),f.translate(-p.x,-p.y),J.drawImage(f,S,p.x-h,p.y-h,d,d,D),f.translate(p.x,p.y),f.rotate(-O),f.translate(-p.x,-p.y)}else if(A.__flowBatch){var r=A.__flowBatchGroup;r||(r=A.__flowBatchGroup={});var F=[p.x,p.y,d/2];r[Y]?r[Y].push(F):r[Y]=[F]}else f.fillStyle=Y,f.arc(p.x,p.y,d/2,0,2*Math.PI,!0),f.fill();if(x){var c=22,T=c+"_"+B+"_"+i,I=l[T];if(I==Z){var H=document.createElement("canvas");U.setCanvas(H,c,c);var t=H.getContext("2d"),W=c/2,E=W,n=W;U.translateAndScale(t,0,0,1),t.beginPath();var N=t.createRadialGradient(E,n,0,E,E,W);N.addColorStop(0,B),N.addColorStop(1,i),t.fillStyle=N,t.arc(E,n,W,0,2*Math.PI,!0),t.fill(),I=l[T]=H}var h=L/2;J.drawImage(f,I,p.x-h,p.y-h,L,L,D)}},G.$9e=function(){var h=this,c=h.dm().$3e;h._24I,c.forEach(function(z){h._24I[z._id]=z}),h.iv()};var Ne=w.prepareRemove;w.prepareRemove=function(P){Ne.call(this,P);var k=P._dataModel,v=k.$3e;if(v)for(var a=v.length,R=0;a>R;R++)if(v[R]===P){v.splice(R,1);break}},G.setFlowInterval=function(_){var h=this,P=h.$11e;h.$11e=_,h.fp("flowInterval",P,_),h.$7e!=Z&&(clearInterval(h.$7e),delete h.$7e,h.enableFlow(_))},G.getFlowInterval=function(){return this.$11e},G.enableFlow=function(y){var D=this,G=D.dm(),u=G.$3e;D.$7e==Z&&(u.forEach(function(r){var U=D.getDataUI(r);j(U)}),D.$7e=setInterval(function(){G.$3e.forEach(function(P){l(D.getDataUI(P))}),D.$9e()},y||D.$11e||50))},G.disableFlow=function(){var y=this;clearInterval(y.$7e),delete y.$7e;var d=y.dm().$3e;d&&y.$9e()};var lq=function(){this.__flowBatchGroup={}},Hg=function(q){var l=this.__flowBatchGroup;if(l){q.save();for(var X in l){q.fillStyle=X,q.beginPath();var n=l[X];n.forEach(function(W){q.moveTo(W[0],W[1]),q.arc(W[0],W[1],W[2],0,2*Math.PI,!0)}),q.fill()}q.restore()}};G.setFlowBatch=function(W){var Z=this;!!Z.__flowBatch!=!!W&&(Z.__flowBatch=W,W?(Z.addBottomPainter(lq),Z.addTopPainter(Hg)):(Z.removeBottomPainter(lq),Z.removeTopPainter(Hg)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);