!function(m,v){"use strict";var f=ht.AlarmSeverity=function(F,G,o,n,A){this.value=F,this.name=G,this.nickName=o,this.color=n,this.displayName=A};ht.Default.def("ht.AlarmSeverity",v,{toString:function(){return this.displayName||this.name}}),function(){f.severities=new ht.List,f._vm={},f._nm={},f._cp=function(j,I){if(j&&I){var o=j.value-I.value;return o>0?1:0>o?-1:0}return j&&!I?1:!j&&I?-1:0},f.each=function(G,R){f.severities.each(G,R)},f.getSortFunction=function(){return f._cp},f.setSortFunction=function(g){f._cp=g,f.severities.sort(g)},f.add=function(p,_,K,Q,Z){var c=new f(p,_,K,Q,Z);return f._vm[p]=c,f._nm[_]=c,f.severities.add(c),f.severities.sort(f._cp),c},f.remove=function(y){var E=f._nm[y];return E&&(delete f._nm[y],delete f._vm[E.value],f.severities.remove(E)),E},f.CRITICAL=f.add(500,"Critical","C","#FF0000"),f.MAJOR=f.add(400,"Major","M","#FFA000"),f.MINOR=f.add(300,"Minor","m","#FFFF00"),f.WARNING=f.add(200,"Warning","W","#00FFFF"),f.INDETERMINATE=f.add(100,"Indeterminate","N","#C800FF"),f.CLEARED=f.add(0,"Cleared","R","#00FF00"),f.isClearedAlarmSeverity=function(f){return f?0===f.value:!1},f.getByName=function(N){return f._nm[N]},f.getByValue=function(l){return f._vm[l]},f.clear=function(){f.severities.clear(),f._vm={},f._nm={}},f.compare=function(q,M){return f._cp(q,M)}}();var d=ht.AlarmState=function(w){this._d=w,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",v,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var j=null;for(var q in this._am)q=f.getByName(q),f.isClearedAlarmSeverity(q)||0!==this.getAcknowledgedAlarmCount(q)&&(j=j?f.compare(j,q)>0?j:q:q);this._haa=j},_c2:function(){var J=null;for(var w in this._nm)w=f.getByName(w),f.isClearedAlarmSeverity(w)||0!==this.getNewAlarmCount(w)&&(J=J?f.compare(J,w)>0?J:w:w);this._hna=J},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var h in this._nm)if(h=f.getByName(h),!f.isClearedAlarmSeverity(h)&&0!==this.getNewAlarmCount(h)&&f.compare(this._hna,h)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var N=this._haa,l=this._hna,P=this._ps;this._hoa=N,f.compare(l,this._hoa)>0&&(this._hoa=l),f.compare(P,this._hoa)>0&&(this._hoa=P)},_c5:function(){var T=this._haa,q=this._hna;this._hta=T,f.compare(q,this._hta)>0&&(this._hta=q)},increaseAcknowledgedAlarm:function(N,O){if(0!==O){O=O||1;var P=this._am[N.name]||0;P+=O,this._am[N.name]=P,this._f()}},increaseNewAlarm:function(Q,$){if(0!==$){$=$||1;var t=this._nm[Q.name]||0;t+=$,this._nm[Q.name]=t,this._f()}},decreaseAcknowledgedAlarm:function(G,i){if(0!==i){i||(i=1);var T=this._am[G.name]||0;if(T-=i,0>T)throw"Alarm count can not be negative";this._am[G.name]=T,this._f()}},decreaseNewAlarm:function(X,m){if(0!==m){m||(m=1);var V=this._nm[X.name]||0;if(V-=m,0>V)throw"Alarm count can not be negative";this._nm[X.name]=V,this._f()}},acknowledgeAlarm:function(y){this.decreaseNewAlarm(y,1),this.increaseAcknowledgedAlarm(y,1)},acknowledgeAllAlarms:function(M){if(M){var J=this.getNewAlarmCount(M);this.decreaseNewAlarm(M,J),this.increaseAcknowledgedAlarm(M,J)}else for(var A in this._nm)this.acknowledgeAllAlarms(f.getByName(A))},_c6:function(){this._aac=0;for(var I in this._am)I=f.getByName(I),this._aac+=this.getAcknowledgedAlarmCount(I)},getAcknowledgedAlarmCount:function(G){return G?this._am[G.name]||0:this._aac},getAlarmCount:function(y){return this.getAcknowledgedAlarmCount(y)+this.getNewAlarmCount(y)},_c7:function(){this._nac=0;for(var U in this._nm)this._nac+=this.getNewAlarmCount(f.getByName(U))},getNewAlarmCount:function(F){return F?this._nm[F.name]||0:this._nac},setNewAlarmCount:function(U,Z){this._nm[U.name]=Z,this._f()},removeAllNewAlarms:function(E){E?delete this._nm[E]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(t,s){this._am[t.name]=s,this._f()},removeAllAcknowledgedAlarms:function(X){X?delete this._am[X.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(J){if(this._ep||(J=null),this._ps!==J){var b=this._ps;this._ps=J,this._f(),this._d.fp("propagateSeverity",b,J)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(h){var N=this._ep;this._ep=h,this._d.fp("enablePropagation",N,h)&&(h||this.setPropagateSeverity(null))}});var C=ht.AlarmStatePropagator=function(B){this._dataModel=B,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",v,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(y){this._enable!==y&&(this._enable=y,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(V){this.propagate(V)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(O){O.data&&this.propagate(O.data)},handleDataPropertyChange:function(E){if("alarmState"===E.property||"enablePropagation"===E.property)this.propagate(E.data);else if("parent"===E.property){var j=E.oldValue;j&&this.propagate(j),this.propagate(E.data)}},propagate:function(g){g&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(g),this._isPropagating=!1)},propagateToTop:function(p){for(this.propagateToParent(null,p);p&&p.getParent();)this.propagateToParent(p,p.getParent()),p=p.getParent()},propagateToParent:function(z,n){var C=null;n.getChildren().each(function(p){var d=p.getAlarmState().getHighestOverallAlarmSeverity();f.compare(d,C)>0&&(C=d)}),n.getAlarmState().setPropagateSeverity(C)}}),ht.AlarmStateStatistics=function(Y){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(Y)},ht.Default.def("ht.AlarmStateStatistics",v,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(E){var H=this._dataModel;H!==E&&(H&&(H.umd(this.handleDataPropertyChange,this),H.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=E,this.reset(),E.md(this.handleDataPropertyChange,this),E.mm(this.handleDataModelChange,this),this.fp("dataModel",H,E))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(j){"alarmState"===j.property&&(this.increase(j.data),this.fireAlarmStateChange())},handleDataModelChange:function(e){"add"===e.kind?(this.increase(e.data),this.fireAlarmStateChange()):"remove"===e.kind?(this.decrease(e.data),this.fireAlarmStateChange()):"clear"===e.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,f.each(function(O){var c=this.getSumInfo(O);this.sumAcked+=c.ackedCount,this.sumNew+=c.newCount,this.sumTotal+=c.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(f){if(!f)return this.sumNew;var i=this.getSumInfo(f);return i.newCount},getAcknowledgedAlarmCount:function(Q){if(!Q)return this.sumAcked;var p=this.getSumInfo(Q);return p.ackedCount},getTotalAlarmCount:function(V){if(!V)return this.sumTotal;var f=this.getSumInfo(V);return f.totalCount},getSumInfo:function(a){var S=this.severtiyMap[a.name];return S||(S={},S.newCount=0,S.ackedCount=0,S.totalCount=0,this.severtiyMap[a.name]=S),S},decrease:function(y){var r=this.dataMap[y.getId()];r&&(delete this.dataMap[y.getId()],f.each(function(I){var G=r[I.name],x=this.getSumInfo(I);x.newCount=x.newCount-G.newCount,x.ackedCount=x.ackedCount-G.ackedCount,x.totalCount=x.totalCount-G.totalCount},this))},increase:function(W){if(this.decrease(W),!this._filterFunc||this._filterFunc(W)){var m={},g=W.getAlarmState();this.dataMap[W.getId()]=m,f.each(function(B){var Y={};Y.newCount=g.getNewAlarmCount(B),Y.ackedCount=g.getAcknowledgedAlarmCount(B),Y.totalCount=g.getAlarmCount(B),m[B.name]=Y;var f=this.getSumInfo(B);f.newCount=f.newCount+Y.newCount,f.ackedCount=f.ackedCount+Y.ackedCount,f.totalCount=f.totalCount+Y.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(S){var P=this._filterFunc;this._filterFunc=S,this.reset(),this.fp("filterFunc",P,S)},getFilterFunc:function(){return this._filterFunc}});var I=ht.Data.prototype;I.getAlarmState=function(){return this._alarmState||(this._alarmState=new d(this))},I=ht.DataModel.prototype,I.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},I.setEnableAlarmStatePropagator=function(f){f!=this.isEnableAlarmStatePropagator()&&(f?(this._alarmStatePropagator=new C(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},I=ht.graph.GraphView.prototype,I.getNote2=function(U){var F=U.getAlarmState().getHighestNewAlarmSeverity();if(F){var q=U.getAlarmState().getNewAlarmCount(F)+F.nickName;return U.getAlarmState().hasLessSevereNewAlarms()&&(q+="+"),q}return U.s("note2")},I.getNote2Background=function(Z){var w=Z.getAlarmState().getHighestNewAlarmSeverity();return w?w.color:Z.s("note2.background")},I.getBodyColor=function(J){var v=J.getAlarmState().getHighestNativeAlarmSeverity();return v?v.color:J.s("body.color")},I.getBorderColor=function(V){var I=V.getAlarmState().getPropagateSeverity();return I?I.color:V.s("border.color")},I=ht.widget.TreeView.prototype,I.getBorderColor=function(Z){var g=Z.getAlarmState().getPropagateSeverity();return g?g.color:Z.s("border.color")},I.getIcon=function(b){return b.getIcon()?"__alarmIcon__":null},I=ht.widget.TreeTableView.prototype,I.getBorderColor=function(I){var V=I.getAlarmState().getPropagateSeverity();return V?V.color:I.s("border.color")},I.getIcon=function(w){return w.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(j){return j.getIcon()}},color:{func:function(D){var j=D.getAlarmState().getHighestNativeAlarmSeverity();return j?j.color:D.s("body.color")}},rect:[0,0,16,16]}]});var N=ht.Style;N["note2.expanded"]=!0,N["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);