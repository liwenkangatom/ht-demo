!function(P,u,$){"use strict";var W=P.ht;W.Astar={},function(y){var k=y();P.AStar=k.astar,P.AStar.Graph=k.Graph}(function(){function s(A){for(var V=A,O=[];V.parent;)O.unshift(V),V=V.parent;return O}function k(){return new b(function(s){return s.f})}function a(Z,o){o=o||{},this.nodes=[],this.diagonal=!!o.diagonal,this.grid=[];for(var s=0;s<Z.length;s++){this.grid[s]=[];for(var $=0,V=Z[s];$<V.length;$++){var c=new B(s,$,V[$]);this.grid[s][$]=c,this.nodes.push(c)}}this.$13x()}function B(K,Y,V){this.x=K,this.y=Y,this.weight=V}function b(P){this.content=[],this.scoreFunction=P}var z={search:function(K,Z,Q,a){K.$6x(),a=a||{};var C=a.heuristic;C||(C=K.diagonal?z.$4x.diagonal:z.$4x.manhattan);var $=a.closest||!1,T=a.punish,q=k(),i=Z;for(Z.h=C(Z,Q),K.$7x(Z),q.push(Z);q.size()>0;){var D=q.pop();if(D===Q)return s(D);D.closed=!0;for(var S=K.neighbors(D),F=0,R=S.length;R>F;++F){var n=S[F];if(!n.closed&&!n.$9x()){var I=D.g+n.getCost(D,T),G=n.visited;(!G||I<n.g)&&(n.visited=!0,n.parent=D,n.h=n.h||C(n,Q),n.g=I,n.f=n.g+n.h,K.$7x(n),$&&(n.h<i.h||n.h===i.h&&n.g<i.g)&&(i=n),G?q.$10x(n):q.push(n))}}}return $?s(i):[]},$4x:{manhattan:function(l,U){var X=Math.abs(U.x-l.x),B=Math.abs(U.y-l.y);return X+B},diagonal:function(O,X){var E=1,C=Math.sqrt(2),k=Math.abs(X.x-O.x),i=Math.abs(X.y-O.y);return E*(k+i)+(C-2*E)*Math.min(k,i)}},$5x:function(i){i.f=0,i.g=0,i.h=0,i.visited=!1,i.closed=!1,i.parent=null}};return a.prototype.$13x=function(){this.dirtyNodes=[];for(var Z=0;Z<this.nodes.length;Z++)z.$5x(this.nodes[Z])},a.prototype.$6x=function(){for(var L=0;L<this.dirtyNodes.length;L++)z.$5x(this.dirtyNodes[L]);this.dirtyNodes=[]},a.prototype.$7x=function(u){this.dirtyNodes.push(u)},a.prototype.neighbors=function($){var T=[],B=$.x,L=$.y,q=this.grid;return q[B-1]&&q[B-1][L]&&T.push(q[B-1][L]),q[B+1]&&q[B+1][L]&&T.push(q[B+1][L]),q[B]&&q[B][L-1]&&T.push(q[B][L-1]),q[B]&&q[B][L+1]&&T.push(q[B][L+1]),this.diagonal&&(q[B-1]&&q[B-1][L-1]&&T.push(q[B-1][L-1]),q[B+1]&&q[B+1][L-1]&&T.push(q[B+1][L-1]),q[B-1]&&q[B-1][L+1]&&T.push(q[B-1][L+1]),q[B+1]&&q[B+1][L+1]&&T.push(q[B+1][L+1])),T},a.prototype.toString=function(){for(var c=[],Y=this.grid,o=0;o<Y.length;o++){for(var i=[],b=Y[o],F=0;F<b.length;F++)i.push(b[F].weight);c.push(i.join(" "))}return c.join("\n")},B.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},B.prototype.getCost=function(X,r){var i;if(i=X&&X.x!=this.x&&X.y!=this.y?1.41421*this.weight:this.weight,r){var u=X;if(!u)return i;var g=u.parent;return g?Math.abs(g.x+this.x-2*u.x)>1e-5?i+r:Math.abs(g.y+this.y-2*u.y)>1e-5?i+r:i:i}},B.prototype.$9x=function(){return 0===this.weight},b.prototype={push:function(y){this.content.push(y),this.$11x(this.content.length-1)},pop:function(){var $=this.content[0],p=this.content.pop();return this.content.length>0&&(this.content[0]=p,this.$12x(0)),$},remove:function(z){var b=this.content.indexOf(z),S=this.content.pop();b!==this.content.length-1&&(this.content[b]=S,this.scoreFunction(S)<this.scoreFunction(z)?this.$11x(b):this.$12x(b))},size:function(){return this.content.length},$10x:function(P){this.$11x(this.content.indexOf(P))},$11x:function(g){for(var u=this.content[g];g>0;){var A=(g+1>>1)-1,m=this.content[A];if(!(this.scoreFunction(u)<this.scoreFunction(m)))break;this.content[A]=u,this.content[g]=m,g=A}},$12x:function(B){for(var V=this.content.length,s=this.content[B],C=this.scoreFunction(s);;){var Q,H=B+1<<1,U=H-1,a=null;if(V>U){var c=this.content[U];Q=this.scoreFunction(c),C>Q&&(a=U)}if(V>H){var y=this.content[H],q=this.scoreFunction(y);(null===a?C:Q)>q&&(a=H)}if(null===a)break;this.content[B]=this.content[a],this.content[a]=s,B=a}}},{astar:z,Graph:a}});var E=W.Astar.Finder=function(i,k){var N=this;N.gv=i,N.$13x(k),N.refreshMap()};E.prototype={},E.prototype.constructor=E,u.defineProperties(E.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(_){this.gv._astarDebugInfo=_}}}),E.prototype.$13x=function(m){var f=this,h=f.$14x={};m=m||{};var S=m.gridSize||10;h.gridSizeX=m.gridSizeX||S,h.gridSizeY=m.gridSizeY||S,h.rect=m.rect,h.filter=m.filter,h.extendBlocks=m.extendBlocks||3,h.fastOverlap=m.fastOverlap===$?!0:m.fastOverlap,h.nodeRectExtend=m.nodeRectExtend||0,h.diagonal=m.diagonal===$?!0:m.diagonal,h.turnPunish=m.turnPunish===$?.1:m.turnPunish,h.simplify=m.simplify===$?!0:m.simplify,h.toGridCenter=m.toGridCenter===$?!1:m.toGridCenter,h.closest=m.closest===$?!0:m.closest},E.prototype.refreshMap=function(){var Y,q=this,z=q.$14x,J=z.gridSizeX,L=z.gridSizeY,D=z.extendBlocks;z.rect?Y=z.rect:(Y=q.$15x(),W.Default.grow(Y,J*D,L*D)),W.Default.grow(Y,J,L);var t=Math.floor(Y.x/J)*J,X=Math.floor(Y.y/L)*L,x=Math.ceil(Y.width/J),$=Math.ceil(Y.height/L),n=x*J,s=$*L;q.$16x={x:t,y:X,w:n,h:s,gridX:J,gridY:L,xLen:x,yLen:$},q.$17x(),q.$21x()},E.prototype.$15x=function(){var j=this.gv;if(j instanceof W.graph.GraphView)return j.getContentRect();var a,q=W.Default.unionRect;return j.dm().each(function(M){j.isVisible(M)&&M.getRect&&(a=q(a,M.getRect()))}),a},E.prototype.$17x=function(){var c,f,u,B,v=this,H=v.$16x,_=H.xLen,Q=H.yLen;for(c=new Array(_),u=0;_>u;u++)for(c[u]=f=new Array(Q),B=Q;B--;)f[B]=1;var C=v.$14x.filter;for(v.gv.dm().each(function(L){C&&C(L)===!1||(!v._debugInfo||L!==v._debugInfo.grid&&L!=v._debugInfo.path)&&v.$1cw(c,L)}),u=0;_>u;u++)c[u][0]=1,c[u][Q-1]=1;for(B=0;Q>B;B++)c[0][B]=1,c[_-1][B]=1;v.grid=c;var h=new AStar.Graph(c,{diagonal:v.$14x.diagonal});v.graph=h},E.prototype.$18x=function(S,F,Q,u,_,X,h,C){var E=this.$19x,$=E(Q-S,_-h,u-F,X-C);if(1e-6>=$&&$>=-1e-6)return!1;var A=E(_-S,_-h,X-F,X-C)/$;if(0>A||A>1)return!1;var O=E(Q-S,_-S,u-F,X-F)/$;return 0>O||O>1?!1:!0},E.prototype.$19x=function(E,g,y,l){return E*l-g*y},E.prototype.$1aw=function(k,H,G,F){for(var y=[-(H[1]-k[1]),H[0]-k[0]],o=y[0]*(G[0]-k[0])+y[1]*(G[1]-k[1])>=0,z=0,C=F.length;C>z;z+=2)if(y[0]*(F[z]-k[0])+y[1]*(F[z+1]-k[1])>=0===o)return!1;return!0},E.prototype.$1bw=function(P,C){for(var y,u,b=this,m=0,O=P.length;O>m;m+=2)if(y=m===O-2?0:m+2,u=y===O-2?0:y+2,b.$1aw([P[m],P[m+1]],[P[y],P[y+1]],[P[u],P[u+1]],C))return!1;for(var m=0,O=C.length;O>m;m+=2)if(y=m===O-2?0:m+2,u=y===O-2?0:y+2,b.$1aw([C[m],C[m+1]],[C[y],C[y+1]],[C[u],C[u+1]],P))return!1;return!0},E.prototype.$1cw=function(d,Y){if(Y.getRect){var F=this,E=Y.getRect();W.Default.grow(E,F.$14x.nodeRectExtend);var _,P,u,Z,x,z,q,C,h,G,g,l=F.$1dw({x:E.x,y:E.y}),i=F.$1dw({x:E.x+E.width,y:E.y+E.height}),r=F.$14x.fastOverlap;if(!r){var s=Y.getCorners();q=[],s.forEach(function(V){q.push(V.x,V.y)}),G=F.$14x.gridSizeX/2,g=F.$14x.gridSizeY/2}for(P=Math.max(0,l.x),u=Math.min(i.x,d.length-1),x=Math.max(0,l.y),z=Math.min(i.y,d.length?d[0].length-1:-1),_=P;u>=_;_++)for(Z=x;z>=Z;Z++)if(r)d[_][Z]=0;else{h=F.$1ew({x:_,y:Z});var k=h.x-G,U=h.x+G,A=h.y-g,w=h.y+g;C=[k,A,k,w,U,w,U,A],F.$1bw(q,C)&&(d[_][Z]=0)}}},E.prototype.$1dw=function(b,R){var s=this,I=s.$16x,A=(b.x-I.x)/I.gridX,n=(b.y-I.y)/I.gridY;return R!==!1&&(A=Math.round(A),n=Math.round(n)),{x:A,y:n}},E.prototype.$1ew=function(y){var z=this,u=z.$16x;return{x:y.x*u.gridX+u.x,y:y.y*u.gridY+u.y}},E.prototype.$1fw=function(D){var Z=this,s=Z.$16x,T=s.xLen,J=s.yLen;if(D.x>=0&&D.x<T&&D.y>=0&&D.y<J)return D;var v={x:D.x,y:D.y};return v.x<0?v.x=0:v.x>=T&&(v.x=T-1),v.y<0?v.y=0:v.y>=J&&(v.y=J-1),v},E.prototype.findPath=function(A,k){var w,e,O,r,J=this,N=J.$1dw(A),E=J.$1dw(k);if(O=J.$1fw(N),r=J.$1fw(E),O!==N&&r!==E){var D=J.$16x,X=D.x-D.gridX/2,B=D.y-D.gridY/2,C=X+D.gridX*D.xLen,s=B+D.gridY*D.yLen;if(!(J.$18x(A.x,A.y,k.x,k.y,X,B,C,B)||J.$18x(A.x,A.y,k.x,k.y,C,B,C,s)||J.$18x(A.x,A.y,k.x,k.y,C,s,X,s)||J.$18x(A.x,A.y,k.x,k.y,X,s,X,B)))return[A,k]}O!==N&&(w=!0,N=O),r!==E&&(e=!0,E=r);var a=J.graph.grid[N.x][N.y],j=J.graph.grid[E.x][E.y],R=AStar.search(J.graph,a,j,{closest:J.$14x.closest,punish:J.$14x.turnPunish});if(!R||!R.length)return null;var v=[];v.push(A),w&&v.push(J.$1ew(R[0]));for(var t=1,F=R.length;F-1>t;t++)v.push(J.$1ew(R[t]));if(e)v.push(J.$1ew(R[F-1])),v.push(k);else{var d=R[F-1];E.x!==d.x||E.y!==d.y||J.$14x.toGridCenter?v.push(J.$1ew(d)):v.push(k)}return J.$14x.simplify&&(v=J.simplifyPath(v)),J.$20x=v,J.$21x(),v},E.prototype.debugOn=function(u){this.debugFlag=!0,this.debugSettings=u||{},this.$21x()},E.prototype.simplifyPath=function(d){var U=d.length;if(2>=U)return d;var Z,G,z=[d[0],d[1]],x=z[0],Q=z[1],V=1e-5;for(Z=2;U>Z;Z++)G=d[Z],Math.abs((Q.x-x.x)*(G.y-x.y)-(Q.y-x.y)*(G.x-x.x))<V?Q=z[z.length-1]=G:(x=Q,Q=G,z.push(G));return z},E.prototype.$21x=function(){var u=this;if(u.$22x(),this.debugFlag){var H=u.grid;if(H){var l,i=u.gv;if(u.debugSettings.$16x!==!1){l=[];for(var o,M,_,z,r,F=[],c=u.$14x.gridSizeX/2,S=u.$14x.gridSizeY/2,x=H.length,V=x?H[0].length:0,w=1;x-1>w;w++)for(var R=1;V-1>R;R++)H[w][R]||(o=u.$1ew({x:w,y:R}),M=o.x-c,_=o.x+c,z=o.y-S,r=o.y+S,l.push({x:M,y:z},{x:M,y:r},{x:_,y:r},{x:_,y:z}),F.push(1,2,2,2,5));var f=new W.Shape;f.s("shape.border.color","rgba(50, 50, 50, 0.2)"),f.s("shape.border.width",1),f.s("shape.background","rgba(200, 50, 100, 0.2)"),f.s("2d.editable",!1),f.s("2d.selectable",!1),f.setPoints(l),f.setSegments(F),u._debugInfo={grid:f},i.dm().add(f)}u.debugSettings.path!==!1&&(l=new W.Shape,u.$20x&&(l.setPoints(u.$20x),l.s("shape.border.color","red"),l.s("shape.border.width",1),l.s("2d.editable",!1),l.s("2d.selectable",!1),l.s("shape.background",null),u._debugInfo||(u._debugInfo={}),u._debugInfo.path=l,i.dm().add(l)))}}},E.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},E.prototype.$22x=function(){var D=this;if(D._debugInfo){var V=D._debugInfo.grid,B=D._debugInfo.path,H=D.gv;V&&H.dm().remove(V),B&&H.dm().remove(B),D._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);