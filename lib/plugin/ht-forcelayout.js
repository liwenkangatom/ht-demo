!function(B,y){"use strict";var E="ht",i=E+".layout.",k=B[E]||module.parent.exports.ht,V=k.List,l=k.DataModel,v=k.Node,s=k.Edge,R=k.Group,p=Math,a=p.sqrt,U=p.random,M=p.max,N=p.min,u=function(I){return I*I};k.Default.getInternal().addMSMap({ms_force:function(r){r._interval=50,r._stepCount=10,r._motionLimit=.01,r._edgeRepulsion=.65,r._nodeRepulsion=.65,r._damper=1,r._maxMotion=0,r._motionRatio=0,r.init=function(r){var x=this;r instanceof l?x.dm=r:x.gv=r,x._nodeMap={},x._nodes=new V,x._edges=new V},r.start=function(){var T=this,i=T.gv;if(!T._timer){var F=T.cdm=i?i.dm():T.dm;F.mm(T.handleDataModelChange,T),F.md(T.handleDataPropertyChange,T),i&&i.mp(T.handleGV,T),F.each(function(G){if(T.isVisible(G)&&T.isLayoutable(G)&&G instanceof v)if(T instanceof g){var $=G.p3();G.p3([$[0]+U(),$[1]+U(),$[2]+U()])}else $=G.p(),G.p($.x+U(),$.y+U())}),T._timer=setInterval(function(){T.relax()},T._interval),T._damper=1}},r.stop=function(){var q=this;q._timer&&(q.cdm.umm(q.handleDataModelChange,q),q.cdm.umd(q.handleDataPropertyChange,q),q.gv&&q.gv.ump(q.handleGV,q),clearInterval(q._timer),delete q._timer,delete q.cdm)},r.handleGV=function(W){var Y=this;if("dataModel"===W.property){var S=W.oldValue,N=W.newValue;S&&(S.umm(Y.handleDataModelChange,Y),S.umd(Y.handleDataPropertyChange,Y)),this.cdm=N,N.mm(Y.handleDataModelChange,Y),N.md(Y.handleDataPropertyChange,Y)}},r.relax=function(){var B=this;if(!(B._damper<.1&&B._maxMotion<B._motionLimit)){this.cdm.each(function(L){B.isVisible(L)&&(L instanceof s?B.addEdge(L):L instanceof v&&B.addNode(L))});for(var z,W,i=0,I=B._edges,H=B._nodes,C=H.size();i<B._stepCount;i++){for(I.each(B.relaxEdge,B),z=0;C>z;z++)for(W=0;C>W;W++)B.relaxNode(H.get(z),H.get(W));B.moveNode()}B._isAdjusting=1,H.each(function(S){S.fix||(S.p?S.v.p3(S.p):S.v.p(S.x,S.y))}),delete B._isAdjusting,B._nodeMap={},H.clear(),I.clear(),B.onRelaxed()}},r.onRelaxed=function(){},r.isRunning=function(){return!!this._timer},r.isVisible=function(S){return S.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(S):!0},r.isLayoutable=function(K){if(K.s("layoutable")===!1)return!1;if(K instanceof R)return!1;var t=this;return t.gv?t.gv.isMovable(K)&&!t.gv.isSelected(K):!(t.cdm||t.dm).sm().co(K)},r.getNodeRepulsion=function(){return this._nodeRepulsion},r.setNodeRepulsion=function(r){this._nodeRepulsion=r,this._damper=1},r.getEdgeRepulsion=function(){return this._edgeRepulsion},r.setEdgeRepulsion=function(t){this._edgeRepulsion=t,this._damper=1},r.getStepCount=function(){return this._stepCount},r.setStepCount=function(z){this._stepCount=z,this._damper=1},r.getInterval=function(){return this._interval},r.setInterval=function(E){var V=this;V._interval!==E&&(V._interval=E,V._timer&&(clearInterval(V._timer),V._timer=setInterval(function(){V.relax()},E)))},r.handleDataPropertyChange=function(J){!this._isAdjusting&&this.isVisible(J.data)&&(this._damper=1)},r.handleDataModelChange=function(){this._damper=1},r.damp=function(){var q=this._maxMotion,M=this._damper;this._motionRatio<=.001&&((.2>q||q>1&&.9>M)&&M>.01?this._damper-=.01:.4>q&&M>.003?this._damper-=.003:M>1e-4&&(this._damper-=1e-4)),q<this._motionLimit&&(this._damper=0)}}}),k.layout.ForceLayout=function(N){this.init(N)},k.Default.def(i+"ForceLayout",y,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(D){this._limitBounds=D,this._damper=1},getNodeSize:function(j){var F=this.gv;return F&&F.getDataUIBounds?F.getDataUIBounds(j):j.getRect()},addNode:function(r){var q=this,s=q._nodeMap[r._id];if(s)return s;var y=r.p();s={v:r,x:y.x,y:y.y,dx:0,dy:0,fix:!q.isLayoutable(r),s:q.getNodeSize(r)};var o=s.s,V=a(u(o.width)+u(o.height))*q._nodeRepulsion;return s.r=1>V?100:V,q._nodeMap[r._id]=s,q._nodes.add(s),s},addEdge:function(e){if(e._40I&&e._41I){var F=this,p=F.addNode(e._40I),t=F.addNode(e._41I),N={s:p,t:t};t=t.s,p=p.s;var s=t.width+p.width,K=t.height+p.height;N.length=a(s*s+K*K)*F._edgeRepulsion,N.length<=0&&(N.length=100),F._edges.add(N)}},relaxEdge:function(p){var i=p.t,n=p.s,s=i.x-n.x,U=i.y-n.y,y=a(s*s+U*U),V=100*p.length,z=.25*s/V*y,Z=.25*U/V*y;i.dx=i.dx-z,i.dy=i.dy-Z,n.dx=n.dx+z,n.dy=n.dy+Z},relaxNode:function(S,A){if(S!==A){var Y=0,N=0,M=S.x-A.x,B=S.y-A.y,o=M*M+B*B;0===o?(Y=U(),N=U()):36e4>o&&(Y=M/o,N=B/o);var H=S.r*A.r/400;Y*=H,N*=H,S.dx+=Y,S.dy+=N,A.dx-=Y,A.dy-=N}},moveNode:function(){var F=this,u=F._limitBounds,t=F._maxMotion,I=0,Y=F._damper;F._nodes.each(function(y){if(!y.fix){var l=y.dx*Y,V=y.dy*Y;if(y.dx=l/2,y.dy=V/2,I=M(a(l*l+V*V),I),y.x+=M(-40,N(40,l)),y.y+=M(-40,N(40,V)),u){y.x<u.x&&(y.x=u.x,F.adjust(1,0)),y.y<u.y&&(y.y=u.y,F.adjust(0,1));var U=y.s;y.x+U.width>u.x+u.width&&(y.x=u.x+u.width-U.width,F.adjust(-1,0)),y.y+U.height>u.y+u.height&&(y.y=u.y+u.height-U.height,F.adjust(0,-1))}}}),F._maxMotion=I,F._motionRatio=I>0?t/I-1:0,F.damp()},adjust:function(K,C){var g=this._limitBounds;this._nodes.each(function(I){K>0?(!g||I.x+I.s.width+K<g.x+g.width)&&(I.x+=K):(!g||I.x+K>g.x)&&(I.x+=K),C>0?(!g||I.y+I.s.height+C<g.y+g.height)&&(I.y+=C):(!g||I.y+C>g.y)&&(I.y+=C)})}});var g=k.layout.Force3dLayout=function(U){this.init(U)};k.Default.def(i+"Force3dLayout",y,{ms_force:1,getNodeSize3d:function(Y){return Y.s3()},addNode:function(p){var O=this,K=O._nodeMap[p._id];if(K)return K;K={v:p,p:p.p3(),d:[0,0,0],fix:!O.isLayoutable(p),s:O.getNodeSize3d(p)};var L=K.s,Q=k.Default.getDistance(L)*O._nodeRepulsion;return K.r=1>Q?100:Q,O._nodeMap[p._id]=K,O._nodes.add(K),K},addEdge:function(n){if(n._40I&&n._41I){var f=this,C=f.addNode(n._40I),L=f.addNode(n._41I),H={s:C,t:L};L=L.s,C=C.s,H.length=a(u(L[0]+C[0])+u(L[1]+C[1])+u(L[2]+C[2]))*f._edgeRepulsion,H.length<=0&&(H.length=100),f._edges.add(H)}},relaxEdge:function(J){var S=J.t.p,k=J.s.p,u=J.t.d,M=J.s.d,i=S[0]-k[0],C=S[1]-k[1],s=S[2]-k[2],h=a(i*i+C*C+s*s),L=100*J.length,R=.25*i/L*h,V=.25*C/L*h,B=.25*s/L*h;u[0]-=R,u[1]-=V,u[2]-=B,M[0]+=R,M[1]+=V,M[2]+=B},relaxNode:function($,T){if($!==T){var H=$.p,N=T.p,J=0,y=0,Q=0,I=H[0]-N[0],v=H[1]-N[1],O=H[2]-N[2],d=I*I+v*v+O*O;0===d?(J=U(),y=U(),Q=U()):216e6>d&&(J=I/d,y=v/d,Q=O/d);var l=$.r*T.r/400,j=$.d,s=T.d;J*=l,y*=l,Q*=l,j[0]+=J,j[1]+=y,j[2]+=Q,s[0]-=J,s[1]-=y,s[2]-=Q}},moveNode:function(){var i=this,O=i._maxMotion,o=0,e=i._damper;i._nodes.each(function(G){if(!G.fix){var g=G.p,X=G.d,n=X[0]*e,D=X[1]*e,v=X[2]*e;X[0]=n/2,X[1]=D/2,X[2]=v/2,o=M(a(n*n+D*D+v*v),o),g[0]+=M(-40,N(40,n)),g[1]+=M(-40,N(40,D)),g[2]+=M(-40,N(40,v))}}),i._maxMotion=o,i._motionRatio=o>0?O/o-1:0,i.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);